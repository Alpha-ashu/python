def extract_value(data, keys, trim_prefix=None):
    """Extracts a value from a nested JSON object using a list of keys.
    If trim_prefix is provided, it removes the first N characters from the value.
    """
    print(f"\nðŸ” Extracting value for path: {'/'.join(keys)}")

    for key in keys:
        if isinstance(data, dict) and key in data:
            data = data[key]  # Move deeper into the JSON structure
        else:
            print(f"âš ï¸ Warning: Key '{key}' not found in JSON structure.")
            return None  # Return None if the key doesn't exist
    
    if isinstance(data, str) and trim_prefix:
        print(f"âœ‚ï¸ Trimming first {trim_prefix} characters from: {data}")
        data = data[trim_prefix:]  # Remove first N characters
    
    print(f"âœ… Extracted Value: {data}")
    return data  # Return the final extracted value

def find_matching_legacy_record(payer_value, legacy_data, legacy_path):
    """Searches for a matching payer value in the Legacy JSON using a given path."""
    print(f"\nðŸ” Searching for Payer Value '{payer_value}' in Legacy JSON at path: {legacy_path}")

    # Extract the list of claims
    claims_list = extract_value(legacy_data, legacy_path.split('/'))

    if not claims_list or not isinstance(claims_list, list):
        print("âš ï¸ Warning: No claims found in Legacy JSON or invalid structure.")
        return None

    # Iterate through each claim and check for a match
    for claim in claims_list:
        legacy_claim_number = extract_value(claim, ["claimInfoCodes", "claimNumber"])
        if legacy_claim_number == payer_value:
            print(f"âœ… Match Found in Legacy JSON: {claim}")
            return claim  # Return the full matching claim record

    print("âŒ No Match Found in Legacy JSON.")
    return None  # Return None if no match is found

def compare_claim_data(matching_claim, payer_data, mapping):
    """Compares data fields between a matched legacy claim and payer claim based on mapping."""
    print("\nðŸ” Starting claim data comparison...")
    comparison_results = []

    for legacy_path, payer_path in mapping.items():
        legacy_value = extract_value(matching_claim, legacy_path.split('/'))
        payer_value = extract_value(payer_data, payer_path.split('/'))
        match_status = "Matched" if legacy_value == payer_value else "Not Matched"
        
        print(f"ðŸ“Œ Comparing: {legacy_path} ({legacy_value}) vs {payer_path} ({payer_value}) => {match_status}")
        comparison_results.append((legacy_path, payer_path, legacy_value, payer_value, match_status))
    
    return comparison_results
